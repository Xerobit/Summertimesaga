$(function(){var $win=$(window);var $doc=$(document);var $bg=$('#background');var $bgBase=$('#background-base');var bgBaseWidth=$bgBase.outerWidth();var bgBaseHeight=$bgBase.outerHeight();var bgZoom=.568;var bgMaxMargin=0;var bgScrollMod=0.4;var $sidebar=$('.sidebar');var $roadmap=$('.roadmap-wrapper');var $news=$('#news-content');$.timeago.settings.strings=$.extend($.timeago.settings.strings,{seconds:'a minute',minute:'a minute',hour:'an hour',hours:'%d hours',month:'a month',year:'a year',});var htmle=function(string){const entityMap={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'};return String(string).replace(/[&<>"'`=\/]/g,function(s){return entityMap[s];})};var ucwords=function(str){return(str+'').replace(/^(.)|\s+(.)/g,function($1){return $1.toUpperCase()})};var rand=function(min,max){return Math.floor(Math.random()*(max-min+1)+min);};var carAnimate=function(type,callback){var easing=[1.000,0.000,0.000,1.000];var $car;var image;var step1;var step2=false;var step1Duration=rand(2000,4500);var step2Duration=rand(2000,4500);var step2Delay=rand(2500,3500);switch(type){case 'bus':$car=$('.bus-left');image='bus';step1={right:[700,$car.css('right')]};step2={right:[1400,700]};break;case 'left':$car=$('.car-left');image='left'+rand(1,6);step1={right:[830,$car.css('right')]};step2={right:[1460,830]};break;case 'top':$car=$('.car-top');image='top'+rand(1,2);step1={opacity:[1,0]};step2={top:[-72,$car.css('top')]};step1Duration=500;step2Delay=250;step2Duration=rand(2500,4500);break;case 'down':$car=$('.car-down');image='down'+rand(1,2);step1={top:[1195,$car.css('top')]};step1Duration=rand(2500,4500);break;case 'bottom':var $car=$('.car-bottom');image='top'+rand(1,2);step1={bottom:[664,$car.css('bottom')]};break;}
$car.css({'display':'block','background-image':'url(assets/img/bg/cars/'+image+'.png)'});var removeElm=function(elm){elm.velocity({opacity:0},{duration:500,delay:rand(1000,2500),complete:function(elm){$(elm).attr('style','');$(elm).hide();if(callback){callback();}}});};$car.velocity(step1,{duration:step1Duration,easing:easing,complete:function(elm){if(!step2){return removeElm(elm);}
elm.velocity(step2,{easing:easing,duration:step2Duration,delay:step2Delay,complete:removeElm})}});};var firstRun=true;var leftCar=function(){setTimeout(function(){carAnimate((firstRun||rand(1,8)==1)?'bus':'left',leftCar);firstRun=false;},rand(500,3000));};var topCar=function(){setTimeout(function(){carAnimate('top',topCar);},rand(1500,5000));};var downCar=function(){setTimeout(function(){carAnimate('down',downCar);},rand(1500,5000));};var bottomCar=function(){setTimeout(function(){carAnimate('bottom',bottomCar);},rand(1500,8000));};leftCar();topCar();downCar();bottomCar();var widthUpdate=function(){var ww=($win.width()<window.screen.width)?$win.width():window.screen.width;var mw=460;var ratio=ww/mw;$('#viewport').attr('content','initial-scale='+((ww<mw)?ratio+', maximum-scale='+ratio+', minimum-scale='+ratio:'1.0, maximum-scale=2, minimum-scale=1.0')+', user-scalable=yes, width='+ww);};$('#menu').on('click','#menu-mobile-btn',function(e){e.preventDefault();if($(this).hasClass('is-active')){$(this).removeClass('is-active');$('#menu-wrapper').hide('slide',{direction:'right'},400,function(){$('#menu-wrapper').attr('style','');});}
else{$(this).addClass('is-active');$('#menu-wrapper').show('slide',{direction:'right'},400);}});$win.on('orientationchange resize load',function(){widthUpdate();$bgBase.css('margin-top',0);var bgHeight=$bg.outerHeight();var widthResize=$bg.outerWidth()/bgBaseWidth;var heightResize=$bg.outerHeight()/bgBaseHeight;var bgZoomCalc=widthResize<heightResize?heightResize:widthResize;bgZoom=Math.max(bgZoomCalc,.38);var bgMaxMarginCalc=bgBaseHeight*bgZoom;bgMaxMargin=bgMaxMarginCalc<=bgHeight?0:bgMaxMarginCalc-bgHeight;bgScrollMod=-Math.abs(Math.min($bg.outerWidth()/bgBaseWidth,1));$bgBase.css('transform','scale('+bgZoom+')');});$win.on('scroll',function(){var bgPos='-'+Math.min(($bg[0].getBoundingClientRect().top-$doc.scrollTop())*bgScrollMod,bgMaxMargin)+'px';$bgBase.css('margin-top',bgPos);$bg.css('background-position-y',bgPos);if($sidebar.length){if($win.scrollTop()>355){if(!$sidebar.hasClass('sidebar-fixed')&&$roadmap.is(':visible')){$sidebar.addClass('sidebar-fixed');}}
else if($roadmap.is(':visible')){$sidebar.removeClass('sidebar-fixed');}}});$doc.on('click','.faq-question',function(e){e.preventDefault();$(this).siblings('p').slideToggle();});$('.screenshots').magnificPopup({delegate:'a',type:'image',closeOnContentClick:false,closeBtnInside:false,mainClass:'mfp-with-zoom mfp-img-mobile',image:{verticalFit:true},gallery:{enabled:true},zoom:{enabled:true,duration:300,opener:function(element){return element.find('img');}}});if($('.progress-bars').length){$.getJSON('/data/progress.json',function(json){$('.progress-title-text').text(json.version+' - '+Math.floor(json.totals.percent.completed)+'%');$('.progress-tasks').text(json.totals.total+' Tasks');$('.progress-art .progress-complete').width(Math.floor(json.depts.art.percent.completed)+'%');$('.progress-art .progress-wip').width(Math.floor(parseFloat(json.depts.art.percent.completed)+parseFloat(json.depts.art.percent.working))+'%');$('.progress-posing .progress-complete').width(Math.floor(json.depts.posing.percent.completed)+'%');$('.progress-posing .progress-wip').width(Math.floor(parseFloat(json.depts.posing.percent.completed)+parseFloat(json.depts.posing.percent.working))+'%');$('.progress-dialogue .progress-complete').width(Math.floor(json.depts.dialogue.percent.completed)+'%');$('.progress-dialogue .progress-wip').width(Math.floor(parseFloat(json.depts.dialogue.percent.completed)+parseFloat(json.depts.dialogue.percent.working))+'%');$('.progress-code .progress-complete').width(Math.floor(json.depts.code.percent.completed)+'%');$('.progress-code .progress-wip').width(Math.floor(parseFloat(json.depts.code.percent.completed)+parseFloat(json.depts.code.percent.working))+'%');$('.progress-art-status').text('['+json.depts.art.closed+'/'+json.depts.art.total+'] '+Math.floor(json.depts.art.percent.completed)+'%');$('.progress-posing-status').text('['+json.depts.posing.closed+'/'+json.depts.posing.total+'] '+Math.floor(json.depts.posing.percent.completed)+'%');$('.progress-dialogue-status').text('['+json.depts.dialogue.closed+'/'+json.depts.dialogue.total+'] '+Math.floor(json.depts.dialogue.percent.completed)+'%');$('.progress-code-status').text('['+json.depts.code.closed+'/'+json.depts.code.total+'] '+Math.floor(json.depts.code.percent.completed)+'%');$('.progress-issues-status').text('['+json.issues.closed+'/'+json.issues.total+'] Fixed');});$.getJSON('/data/commits.json',function(json){$('.progress-footer').text(json.commits+' Changes in last 24hrs');});}
if($roadmap.length){$.getJSON('/data/roadmap.json',function(json){$roadmap.append('<div class="roadmap-item active"><strong>'+htmle(json.v1)+'</strong>'+htmle(json.t1)+'</div><div class="roadmap-item future"><strong>'+htmle(json.v2)+'</strong>'+htmle(json.t2)+'</div><div class="roadmap-item future"><strong>'+htmle(json.v3)+'</strong>'+htmle(json.t3)+'</div><div class="roadmap-item unknown"><strong>'+htmle(json.v4)+'</strong>'+htmle(json.t4)+'</div>');});}
if($news.length){$.getJSON('/data/posts.json',function(json){json.forEach(function(post){$news.append('<div class="card post"><div class="post-meta"><img class="author-avatar" src="'+htmle(post.avatar)+'"><div class="post-author-container"><a class="post-author" href="https://www.patreon.com/summertimesaga" target="_blank" rel="noopener">'+htmle(post.author)+'</a><br><span class="post-date" data-toggle="tooltip" data-placement="right" title="'+htmle(post.date)+'"></span></div><div class="post-stats"></div></div><a class="post-image" href="https://www.patreon.com'+htmle(post.url)+'" target="_blank" rel="noopener">'+((post.patron)?'<img src="/assets/img/locked.png">':(post.image?'<img src="'+htmle(post.image)+'">':''))+'</a><div class="post-content"><h2 class="post-title"><a href="https://www.patreon.com'+htmle(post.url)+'" target="_blank" rel="noopener">'+htmle(post.title)+'</a></h2>'+((post.patron)?'<p>This post is patron only, <a href="https://www.patreon.com/bePatron?c=415949" target="_blank" rel="noopener">click here</a> to support Summertime Saga and gain access!</p>':post.content)+'</div></div>');});var $postDate=$('.post-date');if($postDate.length){$postDate.timeago();$postDate.each(function(){var $elm=$(this);$elm.attr('title',new Date($elm.attr('title')).toString().match(/^(\w+ \w+ \w+ \w+)/)[1]);});}
$('[data-toggle="tooltip"]').tooltip();});}
if($('.table-translations').length){$.getJSON('https://translation-builds.summertimesaga.com/data.json',function(json){Object.keys(json.translations).forEach(function(language){var translation=json.translations[language];$('.table-translations-'+(translation.complete!=100?'ongoing':'complete')+' tbody').append('<tr><td><img src="/assets/img/flags/'+language+'.png"><br>'+language+'</td><td class="d-none d-md-table-cell"><div class="translation-credits">'+htmle(translation.credits)+'</div></td><td>'+(translation.complete==100?'Completed':translation.complete+'%')+'</td><td class="text-nowrap"><span class="translation-updated" title="'+translation.updated+'"></span></td><td><a href="https://translation-builds.summertimesaga.com/'+language+'.rpa?v='+translation.updated+'" target="_blank" rel="noopener"><i class="fas fa-download"></i></a></td></tr>');});$('.translation-updated').timeago();});}});